# Story 1.8: Develop Master Indexing Script for All Sub-Forums

## Status: Done

## Story

- As a Developer/Operator of the Indexing System,
- I want to create a master script that can systematically iterate through a comprehensive list of all Magic Cafe sub-forum IDs (or their base URLs), invoke the Core Indexing Script (from Story 1.6) for each one, and manage the overall process of indexing the entire forum,
- So that I can efficiently generate a complete master Topic Index for all topics across all sub-forums of The Magic Cafe, enabling the subsequent full archival of the forum's content.

## Acceptance Criteria (ACs)

1.  A master script (e.g., a shell script, Python script, or an enhanced Go program) is created that can manage the execution of the Core Indexing Script (from Story 1.6) across multiple sub-forums.
2.  The master script MUST be able to accept or read a list of all target Magic Cafe sub-forum IDs (or their full base URLs). This list might be hardcoded initially, provided as a file, or discovered via a preliminary (manual or semi-automated) step.
3.  For each sub-forum in the list, the master script MUST correctly invoke the Core Indexing Script, passing the necessary parameters (e.g., sub-forum ID/URL, output directory, politeness settings).
4.  The master script MUST ensure that the output Topic Index files from each sub-forum (as generated by Story 1.4's logic within the Core Indexing Script) are stored in a well-organized manner, likely in a common base directory with sub-directories or distinctly named files per sub-forum.
5.  The master script SHOULD provide overall progress indication for the entire forum indexing task (e.g., "Processing sub-forum X of Y", "Estimated time remaining for all sub-forums"). This may involve aggregating ETCs from individual Core Indexing Script runs.
6.  The master script MUST handle errors gracefully if the Core Indexing Script fails for a particular sub-forum (e.g., logs the error, optionally tries to continue with the next sub-forum, or halts based on configuration).
7.  The master script SHOULD support a mechanism for resuming the full forum indexing process if it's interrupted (e.g., by skipping already successfully indexed sub-forums based on the presence of their output Topic Index files).
8.  Upon completion (or interruption), the master script SHOULD provide a summary report, indicating which sub-forums were successfully indexed, which failed (if any), and the locations of the generated Topic Index files.
9.  The master script MUST allow configuration of global parameters that apply to all sub-forum indexing tasks (e.g., a master output directory, default politeness delay, master log file location).
10. The structure of the produced Topic Index files (individually or consolidated) MUST be suitable for consumption by the Archival System (Epic 2) for a full-forum archival operation.
11. (Optional, but Recommended) The master script (or a related utility) MAY provide a way to consolidate all individual sub-forum Topic Index files into a single, comprehensive master Topic Index file for the entire forum, ensuring global de-duplication of Topic IDs if any topic somehow appears listed in multiple sub-forums (though this is unlikely for distinct Topic IDs).

## Tasks / Subtasks

- [x] Subtask 0.1: Develop a Go utility script (e.g., in a new cmd/generate_subforum_list/main.go or scripts/generate_subforum_list.go) to parse forum index HTML (from a specified input file path) and generate data/subforum_list.csv. The CSV will include columns: sub_forum_id, sub_forum_name, base_url, description, topics_count, posts_count, last_active_datetime_str, last_active_by, last_post_id.
- [x] Task 1: Define Sub-Forum List Acquisition.
    - [x] Subtask 1.1: Research and compile a definitive list of all Magic Cafe sub-forum IDs and their names/base URLs.
    - [x] Subtask 1.2: Decide on the format for this list (e.g., CSV, JSON, hardcoded array).
- [x] Task 2: Design Master Script Logic.
    - [x] Subtask 2.1: Choose the language/environment for the master script (e.g., Bash, Python, extend Go app). - Decided: Go.
    - [x] Subtask 2.2: Define how the master script will invoke the Core Indexing Script (Story 1.6). - Decided: Use os/exec to call Core Indexing Script executable with CLI args.
    - [x] Subtask 2.3: Design error handling and reporting for individual sub-forum indexing failures. - Decided: Log errors and continue with the next sub-forum.
    - [x] Subtask 2.4: Design resumption logic (e.g., checking for existing output files). - Decided: Implement a 'completion marker' file (e.g., data/completed_subforums.txt) to track successfully processed sub-forums. Skip marked sub-forums on restart; process unmarked ones, overwriting any prior partial data for them.
    - [x] Subtask 2.5: Design overall progress tracking and ETC aggregation. - Decided: Log 'Processing X of Y'; ETC aggregation is deferred/simplified for now.
- [x] Task 3: Implement Master Script.
    - [x] Subtask 3.1: Implement parsing of the sub-forum list.
    - [x] Subtask 3.2: Implement the loop to iterate through sub-forums and call the Core Indexing Script.
    - [x] Subtask 3.3: Implement parameter passing to the Core Indexing Script.
    - [x] Subtask 3.4: Implement output management for individual Topic Index files.
    - [x] Subtask 3.5: Implement overall progress logging and summary reporting. - Basic per-forum logging implemented. Summary report at end of run.
- [x] Task 4: Implement Configuration.
    - [x] Subtask 4.1: Add CLI arguments or a config file for global parameters (output dir, delay, etc.).
- [x] Task 5: Implement Resumability.
    - [x] Subtask 5.1: Add logic to check for existing index files and skip if desired. - Implemented and tested with completion marker file (data/completed_subforums.txt).
- [x] Task 6: (Optional) Implement Master Index Consolidation.
    - [x] Subtask 6.1: If chosen, develop a utility or function to merge individual index files into one master index.
- [x] Task 7: Testing.
    - [x] Subtask 7.1: Test with a small subset of sub-forums.
    - [x] Subtask 7.2: Test error handling with a deliberately misconfigured or problematic sub-forum ID.
    - [x] Subtask 7.3: Test resumption logic.
    - [x] Subtask 7.4: Verify output structure and content.

## Dev Technical Guidance

- Leverage the robustness and configurability of the Core Indexing Script (Story 1.6). The master script is primarily an orchestrator.
- Prioritize simplicity and reliability for the master script.
- Ensure clear logging from the master script itself, in addition to logs from each Core Indexing Script instance.
- Consider how to manage potentially long runtimes for indexing the entire forum. Resumability is key.
- The list of sub-forums can be obtained by manually inspecting The Magic Cafe's main forum page or sitemap, if one exists. It might be a static list for now.

## Project Structure Notes

- The master script could reside in the `cmd/` directory if it's a Go application, or a `scripts/` directory if it's a shell/Python script.
- A dedicated directory for storing the list of all sub-forums (e.g., `data/subforum_list.csv`) might be useful.
- Output from the master script (consolidated Topic Index, logs) should be organized, perhaps in a `master_index_output/` directory.

## Deviation Analysis

- The primary challenge might be obtaining a 100% accurate and complete list of all sub-forums if the forum structure is complex or not easily enumerable. This might require a manual step or a small, separate utility script.

## Testing Guidance

- **Approach:** Incremental testing. Start with 2-3 sub-forums, then expand. Test edge cases like an invalid sub-forum ID in the list.
- **Test Scenarios:**
    - Successful run over a small list of diverse sub-forums (some small, some slightly larger).
    - Interrupted run and successful resumption.
    - Run where one sub-forum in the list fails to index, but others complete.
    - Verification of consolidated output.
- **Success Criteria:** All ACs met. The master script can reliably orchestrate the indexing of all specified sub-forums, producing organized output and useful logs.
- **Test Data:** A representative list of Magic Cafe sub-forum IDs. The live forum itself.

## Story Progress Notes

### Agent Model Used: `<Agent Model Name/Version>`

### Completion Notes List
- *(To be filled as tasks are completed)*

### Story DoD Checklist Report (Based on ACs)
*   **AC1:** (Master script created) - **Status:** Done
*   **AC2:** (Accepts list of sub-forums) - **Status:** Done
*   **AC3:** (Invokes Core Indexing Script correctly) - **Status:** Done
*   **AC4:** (Manages output files in organized manner) - **Status:** Done
*   **AC5:** (Provides overall progress indication) - **Status:** Done
*   **AC6:** (Handles errors gracefully) - **Status:** Done
*   **AC7:** (Supports resumption) - **Status:** Done
*   **AC8:** (Provides summary report) - **Status:** Done
*   **AC9:** (Allows global configuration) - **Status:** Done
*   **AC10:** (Output suitable for Archival System) - **Status:** Done
*   **AC11:** (Optional: Consolidates into master index) - **Status:** Done

### Change Log

- Initial draft created by `<Your Name/Agent ID>` on YYYY-MM-DD.

## Story Draft Checklist Review (YYYY-MM-DD)

**Review of Story 1.8: Develop Master Indexing Script for All Sub-Forums**

**1. GOAL & CONTEXT CLARITY**
*   [x] Story goal/purpose is clearly stated
*   [x] Relationship to epic goals is evident
*   [x] How the story fits into overall system flow is explained
*   [x] Dependencies on previous stories are identified
*   [x] Business context and value are clear

**2. TECHNICAL IMPLEMENTATION GUIDANCE**
*   [x] Key files to create/modify are identified
*   [x] Technologies specifically needed for this story are mentioned
*   [x] Critical APIs or interfaces are sufficiently described
*   [x] Necessary data models or structures are referenced
*   [x] Required environment variables are listed (covered by CLI/config)
*   [x] Any exceptions to standard coding patterns are noted

**3. REFERENCE EFFECTIVENESS**
*   [x] References to external documents point to specific relevant sections
*   [x] Critical information from previous stories is summarized
*   [x] Context is provided for why references are relevant
*   [x] References use consistent format

**4. SELF-CONTAINMENT ASSESSMENT**
*   [x] Core information needed is included
*   [x] Implicit assumptions are made explicit
*   [x] Domain-specific terms or concepts are explained
*   [x] Edge cases or error scenarios are addressed

**5. TESTING GUIDANCE**
*   [x] Required testing approach is outlined
*   [x] Key test scenarios are identified
*   [x] Success criteria are defined
*   [x] Special testing considerations are noted

**VALIDATION RESULT**

| Category                             | Status | Issues |
| :----------------------------------- | :----- | :----- |
| 1. Goal & Context Clarity            | PASS   |        |
| 2. Technical Implementation Guidance | PASS   |        |
| 3. Reference Effectiveness           | PASS   |        |
| 4. Self-Containment Assessment       | PASS   |        |
| 5. Testing Guidance                  | PASS   |        |

**Final Assessment:**
- READY: The story provides sufficient context for implementation. 